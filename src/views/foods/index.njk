{% extends "layout.njk" %}

{% set title = "Menu" %}

{% block style %}
<style>
  .food-actions {
    cursor: pointer;
  }
  .food-actions a:link {
    color: black;
  }
  .food-actions a:visited {
    color: black;
  }
  .food-actions a:hover {
    text-decoration: none;
  }
  .nav-item {
    text-align: right;
  }
  
  .dark-mode {
    background-color: #222;
    color: #fff;
  }
</style>
{% endblock %}

{% block content %}
<h1 class="mt-5 text-center">
  {{ title }}
</h1>

<div class="text-right">
  <a href="/foods/create" class="btn btn-secondary rounded-circle mr-4 font-weight-bold"
     title="Cadastrar comida">
    +
  </a>
  
  <button id="darkModeButton" class="btn btn-secondary rounded-circle mr-4 font-weight-bold" 
          title="Ativar/desativar tema escuro">
    Dark Mode
  </button>
</div>

<section class="card-deck my-3">
  {% for food in foods %}
  <div class="card-food col-sm-6 col-lg-4 col-xl-3 mb-3" id="food-{{ food.id }}">
    <div class="card">
      <div class="card-header text-center font-weight-bold">
        <span class="food-name">
          {{ food.name }}
        </span>
        <span class="food-actions float-right">
          <a href="/foods/delete/{{ food.id }}" title="Apagar comida">
            <i class="far fa-trash-alt"></i>
          </a>
          <a href="/foods/update/{{ food.id }}" title="Editar comida">
            <i class="fas fa-pencil-alt"></i>
          </a>
        </span>
      </div>
      <div class="card-body p-0">
        <img src="{{ food.image }}" alt="{{ food.name }}" class="w-100">
      </div>
      <div class="card-footer text-right">
        <span class="food-category float-left badge badge-secondary">{{ food.category }}</span>
        <span class="food-price">{{ food.price }}</span>
      </div>
    </div>
  </div>
  {% endfor %}
</section>

<script type="module">
  function setCookie(name, value, days) {
    const date = new Date();
    date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
    const expires = "expires=" + date.toUTCString();
    document.cookie = name + "=" + value + ";" + expires + ";path=/";
  }
 
  function getCookie(name) {
    const cookieName = name + "=";
    const cookies = document.cookie.split(";");
    for (let i = 0; i < cookies.length; i++) {
      let cookie = cookies[i];
      while (cookie.charAt(0) === " ") {
        cookie = cookie.substring(1);
      }
      if (cookie.indexOf(cookieName) === 0) {
        return cookie.substring(cookieName.length, cookie.length);
      }
    }
    return "";
  }
  function checkDarkModeCookie() {
    const darkModeValue = getCookie("darkMode");
    const body = document.querySelector("body");
    body.classList.toggle("dark-mode", darkModeValue === "true");
  }

  function toggleDarkMode() {
    const body = document.querySelector("body");
    const isDarkMode = body.classList.toggle("dark-mode");
    setCookie("darkMode", isDarkMode.toString(), 365);
  }

  const darkModeButton = document.getElementById("darkModeButton");
  darkModeButton.addEventListener("click", toggleDarkMode);
  checkDarkModeCookie();
</script>
{% endblock %}